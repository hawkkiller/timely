version: '3.7'

services:
  timely:
    image: timely/timely:latest
    depends_on:
      - litestream
    build:
      context: .
      dockerfile: dockerfiles/Dockerfile
    networks:
      - timely
    environment:
      - TELEGRAM_TOKEN=${TELEGRAM_TOKEN}
    volumes:
      - timely_data:/timelydb
  litestream:
    image: litestream/litestream:latest
    command: replicate ./data/timely.db s3://timely-backup/timely.db
    volumes:
      - timely_data:/data
    networks:
      - timely
    environment:
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}

networks:
    timely:
        driver: bridge
volumes:
    timely_data: